{% extends "base.html" %}

{% block title %}Blog{% endblock %}

{% block content %}
  <div class="container mt-4">
    <h1 class="mb-4">Gaming Blog</h1>

    <div class="d-flex justify-content-between align-items-center flex-wrap mb-4">
      <div class="d-flex flex-wrap align-items-center">
        <span class="me-2 text-white">Filter by game:</span>
        <a href="{% url 'blog:blog' %}" class="btn btn-outline-light rounded-pill me-2 {% if not selected_game_id %}active{% endif %}">
          All games
        </a>
        {% for game in games %}
          <a href="{% url 'blog:blog' %}?game={{ game.id }}"
             class="btn btn-outline-light rounded-pill me-2 {% if selected_game_id|default:'' == game.id|stringformat:"s" %}active{% endif %}">
            {{ game.name }}
          </a>
        {% endfor %}
      </div>

      <div class="mt-2 mt-md-0">
        {% if request.user.is_authenticated %}
          <a href="{% url 'blog:post-create' %}" class="btn btn-outline-light rounded-pill">Create post</a>
        {% else %}
          <a href="{% url 'login' %}?next={% url 'blog:post-create' %}" class="btn btn-outline-light rounded-pill">ðŸ”’ Login to create post</a>
        {% endif %}
      </div>
    </div>

    {% if posts %}
      <div class="row row-cols-1 row-cols-md-2 g-4" style="overflow-anchor: none;">
        {% for post in posts %}
          <div class="col">
            <div class="card h-100" style="background-color: #191A1C;">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">
                  <a href="{% url 'blog:post-detail' post.pk %}" class="text-decoration-none" style="color: #ffffff;">
                    {{ post.title }}
                  </a>
                </h5>

                {% if post.game %}
                  <span style="display: inline-block;
                               background-color: #ffc107;
                               color: #000;
                               font-size: 0.65rem;
                               padding: 2px 6px;
                               border-radius: 4px;
                               font-weight: bold;
                               margin-bottom: 8px;
                               max-width: max-content;">
                    {{ post.game.name }}
                  </span>
                {% endif %}

                <p class="card-text mt-2" style="color: #ffffff;">
                  {{ post.body|truncatechars:200 }}
                </p>
              </div>
              <div class="card-footer d-flex justify-content-between align-items-center text-white-50">
                <div class="d-flex align-items-center">
                  <i class="bi bi-calendar4 me-1"></i>
                  <small>{{ post.created_at|date:"d.m.Y" }}</small>
                  <span class="mx-2">|</span>
                  <i class="bi bi-chat-left-text me-1"></i>
                  <small>{{ post.comments.count }} comment{{ post.comments.count|pluralize }}</small>
                </div>
                <small><i class="bi bi-person-fill me-1"></i>{{ post.owner }}</small>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No posts available.</p>
    {% endif %}
  </div>
{% endblock %}
