{% extends "base.html" %}

{% block title %}Blog{% endblock %}

{% block content %}
  <div class="container mt-4">
    <h1 class="mb-4">Blog</h1>

    <div class="mb-3 text-end">
      {% if request.user.is_authenticated %}
        <a href="{% url 'blog:post-create' %}" class="btn btn-success">
      âž• Create post
        </a>
      {% else %}
        <a href="{% url 'login' %}?next={% url 'blog:post-create' %}" class="btn btn-outline-primary">
          ðŸ”’ Login to create post
        </a>
      {% endif %}
    </div>

    <!-- Game filter buttons -->
    {% if games %}
      <div class="mb-4">
        <span class="me-2">Filter by game:</span>
        <a href="{% url 'blog:blog' %}" class="btn {% if not selected_game_id %}btn-primary{% else %}btn-outline-secondary{% endif %} me-2">
          All games
        </a>
        {% for game in games %}
          <a href="{% url 'blog:blog' %}?game={{ game.id }}"
             class="btn {% if selected_game_id|default:'' == game.id|stringformat:"s" %}btn-primary{% else %}btn-outline-secondary{% endif %} me-2">
            {{ game.name }}
          </a>
        {% endfor %}
      </div>
    {% endif %}

    {% if posts %}
      <div class="row">
        {% for post in posts %}
          <div class="col-12 mb-3">
            <div class="card w-100">
              <div class="card-body">
                <h5 class="card-title">
                  <a href="{% url 'blog:post-detail' post.pk %}">
                    {{ post.title }}
                  </a>
                </h5>
                {% if post.game %}
                  <span class="badge bg-secondary">{{ post.game.name }}</span>
                {% endif %}
                <p class="card-text mt-2">{{ post.body|truncatechars:200 }}</p>
              </div>
              <div class="card-footer text-muted d-flex justify-content-between align-items-center">
                <div>
                  <small>Posted on: {{ post.created_at|date:"d.m.Y" }}</small> |
                  <small>ðŸ’¬ {{ post.comments.count }} comment{{ post.comments.count|pluralize }}</small>
                </div>
                <small>Author: {{ post.owner }}</small>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No posts available.</p>
    {% endif %}
  </div>
{% endblock %}
